## ç›®å½•

* [1. å‰ç«¯é”™è¯¯/å¼‚å¸¸](#1. å‰ç«¯é”™è¯¯/å¼‚å¸¸)
* [2. JavaScript å¦‚ä½•å·¥ä½œï¼šå¯¹å¼•æ“Žã€è¿è¡Œæ—¶ã€è°ƒç”¨å †æ ˆçš„æ¦‚è¿°](#2. JavaScriptå¦‚ä½•å·¥ä½œï¼šå¯¹å¼•æ“Žã€è¿è¡Œæ—¶ã€è°ƒç”¨å †æ ˆçš„æ¦‚è¿°)
* [](#)
* [](#)

### 1. å‰ç«¯é”™è¯¯/å¼‚å¸¸

##### 1.1 é”™è¯¯ç±»åž‹

1ï¼‰ECMAScript exceptions

> å°±æ˜¯åœ¨ javascript æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯ï¼Œæ¯ä¸€ç§é”™è¯¯éƒ½æœ‰å¯¹åº”çš„é”™è¯¯ç±»åž‹ã€‚å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå°±ä¼šæŠ›å‡ºç›¸åº”çš„é”™è¯¯ç±»åž‹ã€‚

* Error

> JavaScript åŽŸç”Ÿæä¾› Error æž„é€ å‡½æ•°ï¼Œæ‰€æœ‰æŠ›å‡ºçš„é”™è¯¯éƒ½æ˜¯è¿™ä¸ªæž„é€ å‡½æ•°çš„å®žä¾‹ã€‚Error æž„é€ å‡½æ•°æŽ¥å—ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºé”™è¯¯æç¤ºï¼Œå¯ä»¥ä»Žå®žä¾‹çš„ message å±žæ€§è¯»åˆ°è¿™ä¸ªå‚æ•°ã€‚

``` javascript
var err = new Error('throw error');
err.message // 'throw error'
```

* EvalError

> eveal() çš„ä½¿ç”¨ä¸Žå®šä¹‰ä¸ä¸€è‡´ã€‚

* RangeError

> æ•°å€¼è¶Šç•Œã€‚

* ReferenceError

> è®¿é—®æœªç»å£°æ˜Žæˆ–è€…ä¸å­˜åœ¨çš„å˜é‡æ—¶æ‰€è§¦å‘çš„é”™è¯¯ã€‚

* SyntaxError

> å‡ºçŽ°è¯­æ³•è§£æžé”™è¯¯æ—¶

* TypeError

> æ“ä½œæ•°ç±»åž‹é”™è¯¯ï¼Œåœ¨ä¸æ°å½“çš„æ•°æ®ç±»åž‹å˜é‡ä¸Šæ‰§è¡Œä¸æ°å½“çš„æ“ä½œæ—¶ã€‚

* URIError

> endodeURI() æˆ–è€… decodeURI()ï¼Œå½“ä¼ å…¥çš„å­—ç¬¦ URL æ ¼å¼ä¸å¯¹æ—¶ã€‚

2ï¼‰ç½‘ç»œé™æ€èµ„æºåŠ è½½é”™è¯¯

> å¸¸è§çš„ç½‘ç»œé™æ€èµ„æºåŒ…æ‹¬ï¼šhtml æ–‡ä»¶ï¼Œcss æ–‡ä»¶ï¼Œjavascript æ–‡ä»¶ï¼Œå›¾ç‰‡ï¼ŒéŸ³é¢‘ï¼Œè§†é¢‘ï¼Œiframe ç­‰ç­‰ã€‚æ‰€æœ‰çš„ç½‘ç»œé™æ€èµ„æºéƒ½æœ‰å¯èƒ½é‡åˆ°åŠ è½½é”™è¯¯è¿™ä¸ªé—®é¢˜ã€‚

##### 1.2 é”™è¯¯å¤„ç†

1ï¼‰tryÂ·Â·Â·catch

> å¯¹å¯èƒ½å‘ç”Ÿçš„é”™è¯¯è¿›è¡Œå¼‚å¸¸æ•èŽ·ï¼Œä¿è¯åŽé¢çš„ä»£ç æ­£å¸¸è¿è¡Œã€‚

> åªèƒ½æ•èŽ·åˆ°åŒæ­¥ä»£ç å¼‚å¸¸ï¼Œä¸”å‡ºé”™çš„åŒæ­¥ä»£ç æ˜¯å¦ä¼šå½±å“å…¶ä»–çš„ä»£ç æ‰§è¡Œï¼ˆä¸ç®¡åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼‰å–å†³äºŽåŒæ­¥ä»£ç çš„ä¹¦å†™æœŸè€Œä¸æ˜¯æ‰§è¡ŒæœŸã€‚ä¸èƒ½æ•èŽ·è¯­æ³•é”™è¯¯å’Œå¼‚æ­¥ä»£ç äº§ç”Ÿçš„é”™è¯¯ã€‚èƒ½æ•èŽ·  asyncÂ·Â·Â·await æ‰€æŽ¥ç®¡çš„å¼‚æ­¥ä»£ç ã€‚

``` javascript
function error() {
    try {
        return 2;
    } catch (e) {
        return 1;
    } finally {
        return 0;
    }
}
```

2ï¼‰window.error

``` javascript
// è¯­æ³•
// messageï¼šé”™è¯¯ä¿¡æ¯çš„å­—ç¬¦ä¸² string
// sourceï¼šå‡ºé”™ js æ–‡ä»¶çš„ url string
// linenoï¼šå‡ºé”™ä»£ç çš„è¡Œå· number
// colnoï¼šå‡ºé”™ä»£ç çš„åˆ—å· number
// errorï¼šé”™è¯¯å¯¹è±¡ object
window.onerror = function(message, source, lineno, colno, error) {
    ...
}
```

> ä¸èƒ½æ•èŽ·è¯­æ³•è§£æžé”™è¯¯ï¼Œå¼‚æ­¥ä»£ç é”™è¯¯ï¼Œé™æ€èµ„æºçš„åŠ è½½å¤±è´¥ï¼›
> èƒ½æ•èŽ·æ‰§è¡Œ setTimeout å’Œ setInterval ä¸­çš„ä»£ç ï¼›
> èƒ½æ•èŽ·å‘ç”Ÿåœ¨äº‹ä»¶å¤„ç†å‡½æ•°é‡Œé¢çš„é”™è¯¯ï¼ŒåŒ…æ‹¬è¯­æ³•é”™è¯¯ã€‚

3ï¼‰window.addEventListener('error', function() {}, false) å’Œ element.onerror

> èƒ½å¤Ÿæ•èŽ·åˆ°é™¤äº† iframe ä¹‹å¤–çš„æ‰€æœ‰èµ„æºåŠ è½½é”™è¯¯çš„é—®é¢˜ã€‚

4ï¼‰Promise Catch å’Œ window.addEventListener("unhandledrejection", ()=> {})

> Promise Catch è‡ªå¸¦çš„ catch æ¥æ•èŽ· promise æ‰€äº§ç”Ÿçš„å¼‚å¸¸ã€‚

``` javascript
var promiseObj = new Promise(executor);

promiseObj
    .then(handleFulfilledA)
    .then(handleFulfilledB)
    .catch(handleRejectedAny)

// window.addEventListener("unhandledrejection",()=> {})
window.addEventListener("unhandledrejection", function(e) {
    console.log('æ•èŽ·åˆ°çš„promiseå¼‚å¸¸:', e);
    e.preventDefault();
});
new Promise((res) => {
    console.log(a)
});
```

### 2. JavaScript å¦‚ä½•å·¥ä½œï¼šå¯¹å¼•æ“Žã€è¿è¡Œæ—¶ã€è°ƒç”¨å †æ ˆçš„æ¦‚è¿°

##### 2.1 JavaScript å¼•æ“Ž

> ä½¿ç”¨çš„æ˜¯è°·æ­Œ V8 å¼•æ“Žï¼ŒV8 å¼•æ“Žä½¿ç”¨åœ¨ Chrome ä»¥åŠ Node ä¸­ã€‚

      

å¼•æ“Žç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š

* å†…å­˜å †ï¼šå†…å­˜åˆ†é…å‘ç”Ÿçš„åœ°æ–¹ï¼›
* è°ƒç”¨æ ˆï¼šä»£ç æ‰§è¡Œæ—¶çš„åœ°æ–¹ã€‚ 

##### 2.2 è°ƒç”¨æ ˆ

> å•çº¿ç¨‹è¯­è¨€ï¼Œåªæœ‰ä¸€ä¸ªè°ƒç”¨æ ˆï¼ŒåŒä¸€æ—¶é—´åªèƒ½åšä¸€ä»¶äº‹ã€‚

##### 2.3 JavaScript çš„äº‹ä»¶å¾ªçŽ¯

> æ‰§è¡Œåœ¨å•çº¿ç¨‹ä¸­çš„ä»»åŠ¡åˆ†ä¸ºåŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡ã€‚

     

äº‹ä»¶å¾ªçŽ¯è¿‡ç¨‹ï¼š

* åŒæ­¥å’Œå¼‚æ­¥ä»»åŠ¡åˆ†åˆ«è¿›å…¥ä¸åŒçš„æ‰§è¡Œåœºæ‰€ï¼ŒåŒæ­¥ä»»åŠ¡è¿›å…¥ä¸»çº¿ç¨‹ï¼›å¼‚æ­¥ä»»åŠ¡è¿›å…¥Event Tableï¼Œå¹¶æ³¨å†Œå‡½æ•°ï¼›
* å½“æŒ‡å®šçš„äº‹æƒ…å®Œæˆæ—¶ï¼ŒEvent Table ä¼šå°†å‡½æ•°ç§»å…¥ Event Queueï¼ˆäº‹ä»¶é˜Ÿåˆ—ï¼‰ï¼›
* ä¸»çº¿ç¨‹å†…çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¸ºç©ºï¼Œä¼šåŽ» Event Queue è¯»å–å¯¹åº”çš„å‡½æ•°ï¼Œè¿›å…¥ä¸»çº¿ç¨‹æ‰§è¡Œï¼›
* ä¸Šè¿°è¿‡ç¨‹ä¼šä¸æ–­é‡å¤ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ EVent Loopï¼ˆäº‹ä»¶å¾ªçŽ¯ï¼‰ã€‚

##### 2.4 setTimeout å‡½æ•°

> ç»è¿‡æŒ‡å®šçš„æ—¶é—´ï¼ŒæŠŠè¦æ‰§è¡Œçš„ä»»åŠ¡åŠ å…¥åˆ° Event Queue ä¸­ï¼Œåˆå› ä¸ºå•çº¿ç¨‹ä»»åŠ¡æ˜¯ä¸€ä¸ªä¸ªæ‰§è¡Œï¼Œå¦‚æžœå‰é¢çš„ä»»åŠ¡éœ€è¦çš„æ—¶é—´å¤ªä¹…ï¼Œé‚£ä¹ˆå°±åªèƒ½ç­‰ç€ï¼Œç­‰æ‰§è¡Œå®Œæˆä¹‹åŽï¼Œæ‰ä»Žä»»åŠ¡é˜Ÿåˆ—åˆ°ä¸»çº¿ç¨‹ã€‚

setTimeout(fn, 0) çš„å«ä¹‰æ˜¯ï¼Œä¸æ˜¯ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æŒ‡å®šæŸä¸ªä»»åŠ¡åœ¨ä¸»çº¿ç¨‹æœ€æ—©å¯å¾—çš„ç©ºé—²æ—¶é—´æ‰§è¡Œï¼Œåªè¦ä¸»çº¿ç¨‹æ‰§è¡Œæ ˆå†…çš„åŒæ­¥ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæˆï¼Œæ ˆä¸ºç©ºå°±ç«‹é©¬æ‰§è¡Œã€‚

> æ³¨ï¼šå³ä½¿ä¸»çº¿ç¨‹æ˜¯ç©ºçš„ï¼Œ0ms å®žé™…ä¸Šä¹Ÿæ˜¯è¾¾ä¸åˆ°çš„ï¼Œæ ¹æ® HTML çš„æ ‡å‡†ï¼Œæœ€ä½Žæ˜¯ 4msã€‚

##### 2.5 setInterval å‡½æ•°

> ä¸Ž setTimeout ä¸€æ ·ï¼Œåªæ˜¯æ˜¯å¾ªçŽ¯æ‰§è¡Œã€‚

##### 2.6 å¾®ä»»åŠ¡ä¸Žå®ä»»åŠ¡

* macro-taskï¼ˆå®ä»»åŠ¡ï¼‰ï¼šåŒ…æ‹¬æ•´ä½“ä»£ç  scriptã€setTimeoutã€setIntervalï¼›
* micro-taskï¼ˆå¾®ä»»åŠ¡ï¼‰ï¼šPromiseã€process.nextTickã€‚

> ä¸åŒç±»åž‹çš„ä»»åŠ¡ä¼šè¿›å…¥å¯¹åº”çš„äº‹ä»¶é˜Ÿåˆ—ã€‚

 
äº‹ä»¶å¾ªçŽ¯çš„é¡ºåºï¼Œå†³å®š js ä»£ç çš„æ‰§è¡Œé¡ºåºã€‚è¿›å…¥æ•´ä½“ä»£ç ï¼ˆå®ä»»åŠ¡ï¼‰åŽï¼Œå¼€å§‹ç¬¬ä¸€æ¬¡å¾ªçŽ¯ã€‚æŽ¥ç€æ‰§è¡Œæ‰€æœ‰çš„å¾®ä»»åŠ¡ï¼Œç„¶åŽå†æ¬¡ä»Žå®ä»»åŠ¡å¼€å§‹ï¼Œæ‰¾åˆ°å…¶ä¸­ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæ¯•ï¼Œå†æ‰§è¡Œæ‰€æœ‰çš„å¾®ä»»åŠ¡ã€‚

``` javascript
setTimeout(function() {
    console.log('setTimeout');
})

new Promise(function(resolve) {
    console.log('promise');
}).then(function() {
    console.log('then');
})

console.log('console');
```

* ä»£ç ä½œä¸ºå®ä»»åŠ¡ï¼Œè¿›å…¥ä¸»çº¿ç¨‹ï¼›
* å…ˆé‡åˆ° setTimeoutï¼Œå°†å…¶å›žè°ƒå‡½æ•°æ³¨å†ŒåŽåˆ†å‘åˆ°å®ä»»åŠ¡ä»»åŠ¡é˜Ÿåˆ—ï¼›
* æŽ¥ç€é‡åˆ° Promiseï¼Œ new Promise ç«‹å³æ‰§è¡Œï¼Œthen å‡½æ•°è¢«åˆ†å‘åˆ°å¾®ä»»åŠ¡äº‹ä»¶é˜Ÿåˆ—ï¼›
* é‡åˆ° console.log() ç«‹å³æ‰§è¡Œï¼›
* è‡³æ­¤ï¼Œæ•´ä½“ä»£ç  script ä½œä¸ºç¬¬ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œç„¶åŽæ‰§è¡Œå¾®ä»»åŠ¡äº‹ä»¶é˜Ÿåˆ—ä¸­çš„ then å‡½æ•°ï¼›
* ç¬¬ä¸€è½®äº‹ä»¶å¾ªçŽ¯ç»“æŸï¼Œå¼€å§‹ç¬¬äºŒè½®äº‹ä»¶å¾ªçŽ¯ï¼Œä»Žå®ä»»åŠ¡äº‹ä»¶é˜Ÿåˆ—å¼€å§‹ï¼Œå‘çŽ° setTimeout å¯¹åº”çš„å›žè°ƒå‡½æ•°ï¼Œç«‹å³æ‰§è¡Œã€‚

> æ€è€ƒé¢˜ï¼ˆç­”æ¡ˆï¼š 1 7 6 8 2 4 3 5 9 11 10 12ï¼‰

``` javascript
console.log('1');

setTimeout(function() {
    console.log('2');
    process.nextTick(function() {
        console.log('3');
    })
    new Promise(function(resolve) {
        console.log('4');
        resolve();
    }).then(function() {
        console.log('5')
    })
})
process.nextTick(function() {
    console.log('6');
})
new Promise(function(resolve) {
    console.log('7');
    resolve();
}).then(function() {
    console.log('8')
})

setTimeout(function() {
    console.log('9');
    process.nextTick(function() {
        console.log('10');
    })
    new Promise(function(resolve) {
        console.log('11');
        resolve();
    }).then(function() {
        console.log('12')
    })
})
```

##### 2.7 æ€»ç»“

> JavaScript æ˜¯ä¸€é—¨å•çº¿ç¨‹è¯­è¨€ã€‚
> Event Loop æ˜¯ JavaScript çš„æ‰§è¡Œæœºåˆ¶ã€‚

### 3. ES6 è¯­æ³•ä¸­å¸¸é‡å£°æ˜Ž const çš„å®žçŽ°åŽŸç†

``` javascript
// const ç‰¹ç‚¹ï¼š
// ä¸´æ—¶æ€§æ­»åŒº
// åœ¨å®šä¹‰çš„æ—¶å€™å®Œæˆåˆå§‹åŒ–
// ä¸èƒ½é‡æ–°å®šä¹‰
// ä¸èƒ½é‡æ–°èµ‹å€¼
// è¯­ä¹‰åŒ–æ ‡è¯†ï¼Œè¡¨ç¤ºå£°æ˜ŽåŽä¸å¯æ›´æ”¹çš„å˜é‡

// åŽŸç†ï¼š
// å°† const å£°æ˜Žçš„å˜é‡ç»‘å®šåœ¨å…¨å±€å¯¹è±¡ä¸Šï¼Œå€ŸåŠ© Object.defineProperty() åŠ«æŒè¯¥å¯¹è±¡ï¼Œé…ç½®ç›¸å…³å±žæ€§
// å…³é”®å­—å’Œæ•°å­—ä¸èƒ½ä½œä¸ºå¯¹è±¡å±žæ€§

var const_customer = function(param, value) {
    // åœ¨æµè§ˆå™¨ç«¯æµ‹è¯•å…¨å±€å¯¹è±¡ window
    var _gobal = window;
    // å…³é”®å­—åˆ—è¡¨
    var KEY_WORD = ['const', 'let', 'var', 'class', 'return'];
    // æ•°å­—æ­£åˆ™è¡¨è¾¾å¼
    var REG_NUMBER = '^[1-9][0-9]*([.][0-9]+)?$|0';
    var _reg = new RegExp(REG_NUMBER);

    // æ£€æµ‹é”®å€¼æ˜¯å¦å­˜åœ¨ä¸”è¢«æ”¯æŒ
    if (!param || _reg.test(parseFloat(param)) || KEY_WORD.indexOf(param) > -1) {
        throw new Error( `Unexpected token: ${param}` );
    }

    // æ£€æµ‹æ˜¯å¦è¢«å®šä¹‰
    if (_gobal.hasOwnProperty(param)) {
        throw new Error( `${param} had already been declared!` );
    }

    _gobal[param] = value;
    Object.defineProperty(_gobal, param, {
        enumrable: false,
        configurable: false,
        get: function() {
            return value;
        },
        set: {
            function(data) {
                // æ£€æµ‹èµ‹å€¼å¼‚å¸¸
                if (_gobal.hasOwnProperty(param)) {
                    throw new Error( `${param} is read-only!` );
                } else {
                    return value;
                }
            }
        }
    })
}
```

### 4. ä»€ä¹ˆæ˜¯ window å¯¹è±¡ï¼Ÿä»€ä¹ˆæ˜¯ document å¯¹è±¡ï¼Ÿ

> window å¯¹è±¡æ˜¯æŒ‡æµè§ˆå™¨æ‰“å¼€çš„çª—å£ï¼›
> document å¯¹è±¡æ˜¯ document å¯¹è±¡çš„ä¸€ä¸ªåªè¯»å¼•ç”¨ï¼Œwindow å¯¹è±¡çš„ä¸€ä¸ªå±žæ€§ã€‚

### 5. å¼‚æ­¥ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆ

> åŒæ­¥ï¼šè¿žç»­çš„æ‰§è¡Œã€‚
> å¼‚æ­¥ï¼šå°†ä¸€ä¸ªä»»åŠ¡åˆ†æˆä¸¤æ®µï¼Œå…ˆæ‰§è¡Œä¸€æ®µï¼Œç„¶åŽè½¬ä¸ºæ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œç­‰åšå¥½äº†å‡†å¤‡ï¼Œå†å›žå¤´å‡†å¤‡æ‰§è¡Œç¬¬äºŒæ®µã€‚

##### 5.1 å›žè°ƒå‡½æ•°ï¼ˆCallbackï¼‰

> * ä¼˜ç‚¹ï¼šç®€å•ã€å®¹æ˜“ç†è§£å’Œå®žçŽ°ã€‚
> * ç¼ºç‚¹ï¼šä¸åˆ©äºŽä»£ç çš„ç»´æŠ¤å’Œç†è§£ï¼Œå„ä¸ªéƒ¨åˆ†é«˜åº¦è€¦åˆï¼Œä½¿å¾—ç¨‹åºç»“æž„æ··ä¹±ï¼Œæµç¨‹éš¾ä»¥è¿½è¸ªï¼Œä¸”æ¯ä¸ªä»»åŠ¡åªèƒ½æŒ‡å®šä¸€ä¸ªå›žè°ƒå‡½æ•°ï¼Œå®¹æ˜“å†™å‡ºåœ°ç‹±å›žè°ƒã€‚ä¸èƒ½ä½¿ç”¨ tryÂ·Â·Â·catch æ¥æ•èŽ·é”™è¯¯ï¼Œä¸èƒ½ç›´æŽ¥ returnã€‚

##### 5.2 äº‹ä»¶ç›‘å¬

> å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œä¸å–å†³äºŽä»£ç çš„é¡ºåºï¼Œè€Œæ˜¯å–å†³äºŽæŸä¸ªäº‹ä»¶æ˜¯å¦å‘ç”Ÿã€‚

``` javascript
f1.on('done', f2);

function f1() {
    setTimeout(function() {
        f1.trigger('done'); // f1 æ‰§è¡Œå®ŒåŽï¼Œè§¦å‘ done äº‹ä»¶ï¼Œæ‰§è¡Œ f2
    }, 1000);
}
```

##### 5.3 å‘å¸ƒè®¢é˜…

> å‡è®¾å­˜åœ¨ä¸€ä¸ªâ€œä¿¡å·ä¸­å¿ƒâ€ï¼ŒæŸä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå‘ä¿¡å·ä¸­å¿ƒå‘å¸ƒï¼ˆpublishï¼‰ä¸€ä¸ªä¿¡å·ï¼Œå…¶ä»–ä»»åŠ¡å¯ä»¥å‘ä¿¡å·ä¸­å¿ƒè®¢é˜…ï¼ˆsubscribeï¼‰è¿™ä¸ªä¿¡å·ï¼Œä»Žè€ŒçŸ¥é“è‡ªå·±ä»€ä¹ˆæ—¶å€™å¯ä»¥å¼€å§‹æ‰§è¡Œã€‚è¿™ç§æ¨¡å¼å«åšå‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼ˆpublish-subscribe patternï¼‰ï¼Œä¹Ÿå«åšâ€œè§‚å¯Ÿè€…æ¨¡å¼â€ï¼ˆobserver patternï¼‰ã€‚

``` javascript
// jQuery ä¿¡å·ä¸­å¿ƒ
jQuery.subscribe('done', f2);

function f1() {
    setTimeout(function() {
        jQuery.publish('done');
    }, 1000);
}

// å–æ¶ˆè®¢é˜…
jquery.unsubscribe('done', f2);
```

##### 5.4 Promise

###### 5.4.1 Promise åŸºç¡€

> Promise æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æžœã€‚
> ç‰¹ç‚¹ï¼š
> * å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼šPendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€Fulfilledï¼ˆå·²æˆåŠŸï¼‰ã€Rejectedï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æžœèƒ½å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ã€‚
> * ä¸€æ—¦çŠ¶æ€æ”¹å˜å°±ä¸ä¼šå†å˜ã€‚ä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æžœã€‚

``` javascript
// resolve reject æ˜¯ä¸¤ä¸ªå‡½æ•°
// resolve å‡½æ•°çš„ä½œç”¨æ˜¯å°† Promise çš„çŠ¶æ€ä»Žâ€œæœªå®Œæˆâ€œå˜æˆâ€œæˆåŠŸâ€ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æžœä½œä¸ºå‚æ•°ä¼ é€’å‡ºåŽ»ã€‚
// reject å‡½æ•°çš„ä½œç”¨æ˜¯å°† Promise çš„çŠ¶æ€ä»Žâ€œæœªå®Œæˆâ€å˜æˆâ€œå¤±è´¥â€ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ä½œä¸ºå‚æ•°ä¼ é€’å‡ºåŽ»ã€‚
var promise1 = new Promise(function(resolve, reject) {
    // if(/* success */) {
    //     resolve(value);
    // }else {
    //     reject(value)
    // }
});

// Promise å®žä¾‹ç”Ÿæˆä¹‹åŽï¼Œå¯ä»¥é€šè¿‡ then æ–¹æ³•æŒ‡å®š Resolved çŠ¶æ€å’Œ Rejected çŠ¶æ€çš„å›žè°ƒå‡½æ•°ã€‚
promise1.then(function(value) {
    // success
}, function(value) {
    // failure
});

// ä¾‹å­ ðŸŒ°
var promise2 = new Promise(function(resolve) {
    console.log('Promise');
    resolve('resolve function');
})

promise2.then(function(value) {
    console.log('then ' + `${value}` )
})

console.log('hi')

// Promise
// hi
// then resolve function
// Promise åœ¨åˆ›å»ºä¹‹åŽå°±ä¼šç«‹å³æ‰§è¡Œï¼Œé¦–å…ˆè¾“å‡ºçš„æ˜¯ Promiseï¼Œç„¶åŽ then æ–¹æ³•æŒ‡å®šçš„å›žè°ƒå‡½æ•°å°†åœ¨å½“å‰è„šæœ¬æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®ŒæˆåŽæ‰æ‰§è¡Œï¼Œæ‰€ä»¥æœ€åŽæ‰§è¡Œã€‚
```

###### 5.4.2 Promise.prototype.then()

> ä½œç”¨ï¼šä¸º Promise å®žä¾‹æ·»åŠ çŠ¶æ€æ”¹å˜æ—¶çš„å›žè°ƒå‡½æ•°ã€‚
> è¿”å›žçš„ç»“æžœæ˜¯ä¸€ä¸ªæ–°çš„ Promise å®žä¾‹ï¼Œä¸æ˜¯åŽŸæ¥çš„é‚£ä¸ª Promise å®žä¾‹ã€‚

```javascript
// then æ–¹æ³•ä¾æ¬¡æŒ‡å®šäº†ä¸¤ä¸ªå›žè°ƒå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå›žè°ƒå‡½æ•°å®Œæˆä¹‹åŽï¼Œä¼šå°†è¿”å›žç»“æžœä½œä¸ºå‚æ•°ä¼ é€’ç»™ç¬¬äºŒä¸ªå›žè°ƒå‡½æ•°ã€‚

getJSON("/post/1.json").then(
    post => console.log(post.commentURL);
).then(
    comments => console.log("Resolved: ", comments);
    error => console.log("Rejected: ", error)
)
``` 

###### 5.4.3 Promise.prototype.catch()

> ä½œç”¨ï¼šç”¨äºŽæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›žè°ƒå‡½æ•°ã€‚æ˜¯ .then(null, rejection) çš„åˆ«åã€‚then æ–¹æ³•æŒ‡å®šçš„å›žè°ƒå‡½æ•°å¦‚æžœåœ¨è¿è¡Œä¸­æŠ›å‡ºé”™è¯¯ï¼Œä¹Ÿä¼šè¢« catch æ–¹æ³•æ•èŽ·ã€‚

```javascript
getJSON('/posts.json').then(function(posts) {
    // ...
}).catch(function(error) {
    // å¤„ç† getJSON å’Œå‰ä¸€ä¸ªå›žè°ƒå‡½æ•°è¿è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯
    console.log('å‘ç”Ÿé”™è¯¯', error)
})

// å»ºè®®ä½¿ç”¨ catch æ–¹æ³•ï¼Œè€Œä¸æ˜¯ç¬¬äºŒä¸ª then æ–¹æ³•ï¼Œå› ä¸ºå¯ä»¥æ•èŽ·åˆ°ä¸Šä¸€ä¸ª then æ–¹æ³•ä¸­å‡ºçŽ°çš„é”™è¯¯ã€‚
var promise = new Promise(resolve, rejected) {};
promise.then(function(data) {
    //success
}).catch(function(error) {
    console.log(error)
})
``` 

###### 5.4.4 Promise.all()

> ç”¨äºŽå°†å¤šä¸ª Promise å®žä¾‹åŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®žä¾‹ã€‚

```javascript
// Promise.all æ–¹æ³•æŽ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œp1, p2, p3 éƒ½æ˜¯ Promise å¯¹è±¡çš„å®žä¾‹ï¼›å¦‚æžœä¸æ˜¯ï¼Œå°±ä¼šå…ˆè°ƒç”¨ä¸‹é¢è®²åˆ°çš„ Promise.resolve æ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º Promise å®žä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†
// p çš„çŠ¶æ€åˆ†ä¸¤ç§æƒ…å†µï¼š
// 1 p1, p2, p3 çš„çŠ¶æ€éƒ½å˜ä¸º Fulfilled æ—¶ï¼Œp çš„çŠ¶æ€æ‰å˜ä¸º Fulfilled ï¼Œæ­¤æ—¶ p1, p2, p3 çš„è¿”å›žå€¼ä½œä¸ºä¸€ä¸ªæ•°ç»„ä¼ é€’ç»™ p çš„å›žè°ƒå‡½æ•°ã€‚
// 2 p1, p2, p3 çš„çŠ¶æ€åªè¦æœ‰ä¸€ä¸ªè¢« Rejectedï¼Œåˆ™ p çš„çŠ¶æ€å°±å˜ä¸º Rejectedï¼Œæ­¤æ—¶ä¼šå°†ç¬¬ä¸€ä¸ªè¢« Rejected çš„å®žä¾‹çš„è¿”å›žå€¼ä¼ é€’ç»™ p çš„å›žè°ƒå‡½æ•°ã€‚

var p = Promise.all([p1, p2, p3]);

var promises = [2, 3, 5, 7].map(function(id) {
    return getJSON('/post' + id + '.json');
});

Promise.all(promises).then(function(posts) {
    // ...
}).catch(function(err) {
    // ...
});
``` 

###### 5.4.5 Promise.race()

> ä¹Ÿæ˜¯å°†å¤šä¸ª Promise å®žä¾‹åŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®žä¾‹ã€‚
> åªè¦å¤šä¸ªå®žä¾‹ä¸­çš„å…¶ä¸­ä¸€ä¸ªçŽ‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œåˆ™ p çš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚

###### 5.4.6 Promise.resolve()

> å°†çŽ°æœ‰å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ã€‚

```javascript
Promise.resolve('foo');
//  ç­‰ä»·äºŽ
new Promise(resolve => resolve('foo'));

// å…¶å‚æ•°åˆ†ä¸º 4 ç§æƒ…å†µï¼š
// 1 å‚æ•°æ˜¯ä¸€ä¸ª Promise å®žä¾‹ï¼Œåˆ™ä¸åšä»»ä½•ä¿®æ”¹ï¼›

// 2 å‚æ•°æ˜¯ä¸€ä¸ª thenable å¯¹è±¡ï¼ˆæŒ‡å…·æœ‰ then æ–¹æ³•çš„å¯¹è±¡ï¼‰ã€‚
let thenable = {
    then: function(resolve, rejected) {
        resolve(42);
    }
};
// å°†å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ï¼Œç„¶åŽç«‹å³æ‰§è¡Œ thenable å¯¹è±¡çš„ then æ–¹æ³•ã€‚
let p1 = Promise.resolve(thenable);
p1.then(function(value) {
    console.log(value)
})

// 3 å‚æ•°ä¸æ˜¯å…·æœ‰ then æ–¹æ³•çš„å¯¹è±¡æˆ–è€…æ ¹æœ¬ä¸æ˜¯å¯¹è±¡ï¼Œåˆ™è¿”å›žä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼ŒçŠ¶æ€ä¸º resolvedã€‚

// 4 ä¸å¸¦ä»»ä½•å‚æ•°
``` 

###### 5.4.7 Promise.reject()

###### 5.4.8 Promise.done()

> æ€»æ˜¯åœ¨å›žè°ƒé“¾çš„å°¾ç«¯ï¼Œä¿è¯æŠ›å‡ºä»»ä½•å¯èƒ½å‡ºçŽ°çš„é”™è¯¯ã€‚

```javascript
asyncFunc()
.then(f1)
.catch(r1)
.then(f2)
.done();

// å®žçŽ°åŽŸç†
Promise.prototype.done = function(onFulfilled, onRejected) {
    this.then(onFulfilled, onRejected)
    .catch(function(reason) {
        // æŠ›å‡ºä¸€ä¸ªå…¨å±€é”™è¯¯
        setTimeout(() => {throw reason}, 0);
    })
}
``` 

###### 5.4.9 Promise.finally()

###### 5.4.9 åº”ç”¨

```javascript
// åŠ è½½å›¾ç‰‡ï¼Œä¸€æ—¦å®ŒæˆåŠ è½½ï¼ŒPromise çš„çŠ¶æ€å°±å‘ç”Ÿå˜åŒ–ã€‚
const preloadImage = function(path) {
    return new Promise(resolve, reject) {
        var image = new Image();
        image.onload = resolve;
        image.onerror = reject;
        image.src = path;
    }
}
``` 

##### 5.6 Generator å‡½æ•°

> ES6 æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆã€‚æœ€å¤§çš„ç‰¹ç‚¹æ˜¯å¯ä»¥æŽ§åˆ¶å‡½æ•°çš„æ‰§è¡Œã€‚
> * è¯­æ³•ä¸Šï¼Œå¯ä»¥ç†è§£æˆä¸€ä¸ªçŠ¶æ€åŠï¼Œå°è£…å¤šä¸ªå†…éƒ¨çŠ¶æ€ï¼›
> * æ‰§è¡Œ Generator å‡½æ•°ä¼šè¿”å›žä¸€ä¸ªéåŽ†å™¨å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªéåŽ†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ã€‚è¿”å›žçš„éåŽ†å™¨å¯¹è±¡å¯ä»¥ä¾æ¬¡éåŽ† Generator å‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€ï¼›
> * ä½¿ç”¨ yield è¯­å¥å®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€ï¼›

###### 5.6.1 yield è¡¨è¾¾å¼

> yield è¯­å¥æ˜¯æš‚åœæ ‡å¿—ï¼Œåœ¨æ­¤å¤„æš‚åœï¼Œåªä¼šåœ¨ next æ–¹æ³•å°†æŒ‡é’ˆç§»åˆ°è¿™ä¸€å¥æ—¶æ‰æ±‚å€¼ï¼Œä¸”è¿”å›žçš„æ˜¯ yield åŽè¡¨è¾¾å¼çš„ç»“æžœã€‚

###### 5.6.1 next æ–¹æ³•çš„å‚æ•°

> yield è¯­å¥æœ¬èº«æ²¡æœ‰è¿”å›žå€¼ï¼Œæˆ–è€…è¯´æ€»æ˜¯è¿”å›ž undefinedã€‚next æ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°ä¼šè¢«å½“ä½œä¸Šä¸€æ¡ yield è¯­å¥çš„è¿”å›žå€¼ã€‚

```javascript
function *foo(x) {
    var y = yield (x + 2);
    var z = 3 * (yield(y - 1));
    return (x + y + z);
}
var a = foo(5);

console.log(a.next()); // {value: 7, done: false}
console.log(a.next(12)); // {value: 11, done: false}
// x = 5, y = 12, z = 24
console.log(a.next(8)); // {value: 41, done: true}
``` 

###### 5.6.1 yield è¡¨è¾¾å¼



##### 5.7 async / await

>  

##### 5.8

>  

##### 5.9

>  

* 

```javascript

``` 

``` javascript

```

``` javascript

```
